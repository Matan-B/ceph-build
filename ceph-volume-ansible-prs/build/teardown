#!/bin/bash
# There has to be a better way to do this than this script which just looks
# for every Vagrantfile in scenarios and then just destroys whatever is left.

# the following two methods exist in scripts/build_utils.sh
pkgs=( "tox" "github-status>0.0.3" )
TEMPVENV=$(create_venv_dir)
VENV=${TEMPVENV}/bin
install_python_packages $TEMPVENV "pkgs[@]"

GITHUB_STATUS_STATE="failure" $VENV/github-status create

CEPH_VOLUME_FUNCTIONAL_TESTS_PATH=$WORKSPACE/src/ceph-volume/ceph_volume/tests/functional
COLLECT_LOGS_PLAYBOOK_PATH="$CEPH_VOLUME_FUNCTIONAL_TESTS_PATH/$SUBCOMMAND/.tox/${DISTRO}-${OBJECTSTORE}-${SCENARIO}/tmp/ceph-ansible/tests/functional/collect-logs.yml"
cd "$CEPH_VOLUME_FUNCTIONAL_TESTS_PATH"

# the method exists in scripts/build_utils.sh
teardown_vagrant_tests "$VENV" "$COLLECT_LOGS_PLAYBOOK_PATH"
